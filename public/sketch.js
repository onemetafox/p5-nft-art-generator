class Random{constructor(e){this.seed=e,this.originalSeed=e}randDec(){return this.seed^=this.seed<<13,this.seed^=this.seed>>17,this.seed^=this.seed<<5,(this.seed<0?1+~this.seed:this.seed)%1e3/1e3}randNum(e,a){return e+(a-e)*this.randDec()}randInt(e,a){return Math.floor(this.randNum(e,a+1))}reset(){this.seed=this.originalSeed}}var sww=700,shh=840;let canvas;const st_deviation=50,layers=80;var left_x,right_x,top_y,bottom_y,resolution,num_columns,num_rows,grid,offset;let img,easing=.05;var imgList=[image11+image12+image13+image14+image15,image21+image22+image23+image24+image25+image26+image27,image31+image32+image33+image34+image35+image36+image37,image41+image42+image43+image44+image45+image46,image51+image52+image53+image54+image55];const num_steps=200,step_length=5;let angoff=0,shapecolors=[],pentagons=[],x1=[],y1=[],x2=[],y2=[];var pp=[[300,-300],[300,-100],[300,100],[300,300],[300,500]];let tokenData={hash:random_hash(),tokenId:"123000456"};const defaultSize=1e3,ratio=.83;let hh=shh,ww=sww,dim=Math.min(ww,hh),M=dim/1e3;console.log(`M: ${M}`),console.log(`Hash: ${tokenData.hash}`);const seed=parseInt(tokenData.hash.slice(0,16),16);console.log(`Seed: ${seed}`);const R=new Random(seed);function random_hash(){let e="0123456789abcdef",a="0x";for(let t=64;t>0;--t)a+=e[Math.floor(Math.random()*e.length)];return a}function preload(){img=loadImage(imgList[random([1,2,3,4,5])]),angoff=PI/180*random(0,360),left_x=Math.round(-.5*ww),right_x=Math.round(1.5*ww),top_y=Math.round(-.5*hh),bottom_y=Math.round(1.5*hh),resolution=Math.round(.01*ww),num_columns=Math.round((right_x-left_x)/resolution),num_rows=Math.round((bottom_y-top_y)/resolution),grid=new Array(num_columns);for(var e=0;e<num_columns;e++)grid[e]=new Array(num_rows);for(pentagons=[],shapecolors=[],e=0;e<5;e++)pentagons.push(createStretchedPentagon(pp[e][0],pp[e][1])),shapecolors.push([random(0,150),random(0,150),random(0,150),10]);for(x1=[],y1=[],x2=[],y2=[],e=0;e<10;e++)x1.push(random(0,ww/2)),y1.push(random(0,hh/2)),x2.push(random(ww/2,ww)),y2.push(random(0,hh/2))}function setup(){noStroke(),canvas=createCanvas(ww,hh),background(255);for(var e=0;e<5;e++)drawCustomShape(pentagons[e],shapecolors[e]);beginShape();for(var a=0;a<num_columns;a++)for(var t=0;t<num_rows;t++){var o=.01*parseFloat(a),n=.01*parseFloat(t),r=noise(o,n);angle=map(r,0,1,0,TWO_PI)+radians(100),grid[a][t]=angle}var s=color(255,255,255);for(s.setAlpha(2),fill(s),e=0;e<10;e++)myFlowField(x1[e],y1[e],num_steps);for(e=0;e<10;e++)myFlowField(x2[e],y2[e],num_steps);endShape(),tint(255,180),translate(ww/2,hh/2),rotate(angoff),imageMode(CENTER),image(img,0,0,1.5*ww,1.25*hh)}function draw(){noStroke();let e=color(191,185,185);fill(e),rect(0,0,12,hh),rect(0,0,ww,12),rect(0,hh-12,ww,hh),rect(ww-12,0,ww,hh)}function windowResized(){hh=window.innerHeight,ww=hh*ratio;const e=Math.min(ww,hh);M=e/defaultSize,console.log(`M: ${M}`),R.reset(),resizeCanvas(ww,hh),setup()}function createStretchedPentagon(e,a){return[createVector(910+randomGaussian(0,e)+a,320+a),createVector(830.9188309203678+randomGaussian(0,e)+a,510.9188309203678+a),createVector(640+randomGaussian(0,e)+a,590+a),createVector(449.0811690796322+randomGaussian(0,e)+a,510.91883092036784+a),createVector(370+randomGaussian(0,e)+a,320.00000000000006+a),createVector(449.0811690796321+randomGaussian(0,e)+a,129.0811690796322+a),createVector(640+randomGaussian(0,e)+a,50+a),createVector(830.9188309203678+randomGaussian(0,e)+a,129.08116907963213+a)]}function myFlowField(e,a,t){for(var o=0;o<t;o++){var n=e-left_x,r=a-top_y,s=Math.round(n/resolution),i=Math.round(r/resolution);s>=num_columns&&(s=num_columns-1),i>=num_rows&&(i=num_rows-1);var h=grid[s][i],m=Math.abs(step_length*cos(h)),d=Math.abs(step_length*sin(h));ellipse(e,a,30*m,30*d),e+=m,a+=d}}function drawCustomShape(e,a){for(let t=0;t<layers;t+=1){let t=polygon(e,1);fill(a),beginShape();for(let e of t)vertex(e.x,e.y);let o=getXmax(t),n=getYmax(t);for(let e=0;e<100;e+=1){let e=random(0,o),a=random(0,n),t=1e3*Math.abs(randomGaussian(o,.03)-randomGaussian(o,.02));ellipse(e,a,t,t)}endShape(CLOSE)}}function getXmax(e){let a=e[0].x;for(let t=0;t<e.length;t+=1)a<e[t].x&&(a=e[t].x);return a}function getYmax(e){let a=e[0].y;for(let t=0;t<e.length;t+=1)a<e[t].y&&(a=e[t].y);return a}function polygon(e,a){if(a>=7)return e;{const t=[];for(let a in e){t.push(e[a]);let o=int(a)+1;try{const n=createVector((e[o].x+e[a].x)/2,(e[o].y+e[a].y)/2),r=randomGaussian(0,st_deviation),s=randomGaussian(0,st_deviation);n.add(r,s),t.push(n)}catch(o){const n=createVector((e[0].x+e[a].x)/2,(e[0].y+e[a].y)/2),r=randomGaussian(0,st_deviation),s=randomGaussian(0,st_deviation);n.add(r,s),t.push(n)}}return polygon(t,a+1)}}